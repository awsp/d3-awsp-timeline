var TwoDimensionalShape=function(){function t(t,e){this.aHeight=e,this.aWidth=t}return t.prototype.width=function(t){if(t)if(+t>0)this.aWidth=t;else if(!(t.toString().match(/\%/).length>=0))throw new Error("Width must be a number and greater than 0. ");return this.aWidth},t.prototype.height=function(t){if(t){if(!(+t>0))throw new Error("Height must be a number and greater than 0. ");this.aHeight=t}return this.aHeight},t}(),ScheduleType=function(){function t(t,e){this.markOverlap=!1,this.height=24,this.hasLabel=!1,this.opacity=.9,this.backgroundColor="#ccffcc",this.foregroundColor="#447744",this.zIndex=0,this.round=0,this.stroke="",this.strokeWidth=0,this.fontSize=11,this.overlapClass="overlapping",this.allowedBatch=["backgroundColor","foregroundColor","stroke","strokeWidth","fontSize","round","zIndex","opacity","height","markOverlap","hasLabel","name","overlapClass"],this.setId(t),e&&this.setOptions(e)}return t.prototype.setOptions=function(t){if(t)for(var e in t){var i=t[e];this.hasOwnProperty(e)&&this.allowedBatch.indexOf(e)>=0&&(this[e]=i)}return this},t.prototype.setId=function(t){return this.id=t,this},t.prototype.setName=function(t){return this.name=t,this},t.prototype.enableOverlapping=function(){return this.markOverlap=!0,this},t.prototype.disableOverlapping=function(){return this.markOverlap=!1,this},t.prototype.enableLabeling=function(){return this.hasLabel=!0,this},t.prototype.disableLabeling=function(){return this.hasLabel=!1,this},t}(),ScheduleTypeCollection=function(){function t(){this.list=[]}return t.prototype.add=function(t){this.list.push(t)},t.prototype.remove=function(t){this.list[t]&&delete this.list[t]},t.prototype.get=function(){return this.list},t}(),TimelineGroup=function(){function t(t){if(this.domInstance=null,this.svgInstance=null,this.rowHeight=21,this.aHeight=0,this.textFactorBase=9,!t)throw new Error("Dimension is not set. ");this.aDimension=t}return t.prototype.dimension=function(){return this.aDimension},t.prototype.height=function(){return Object.keys(this.aData).length*this.rowHeight},t.prototype.setRowHeight=function(t){this.rowHeight=t},t.prototype.getRowHeight=function(){return this.rowHeight},t.prototype.init=function(t,e,i){this.gParent=e,this.moduleName=t,this.aData=i;var r=this.aHeight=this.height(),n=this.gParent.append("div");n.attr("id",this.moduleName+"-grouping").attr("class","list-module"),n.attr("style","width: "+this.dimension().width()+(+this.dimension().width()>=0?"px":"")+"; height: "+(this.dimension().height()-TimelineChart.timelineHeight)+"px; margin-top: "+TimelineChart.timelineHeight+"px;");var a=n.append("svg");a.attr("width",this.dimension().width()).attr("height",r),this.domInstance=n,this.svgInstance=a},t.prototype.drawData=function(t){var e=this;t||(t=this.aData);var i=this.svgInstance,r=i.append("g").attr("transform","translate(0, 0)"),n=this.rowHeight;i.attr("height",this.height());var a=r.selectAll("g").data(d3.values(t)),s=a.enter().append("g").attr("transform",function(t,e){return"translate(0, "+n*e+")"});s.append("rect").attr("height",n).attr("width",this.dimension().width()).attr("class",function(t,e){return e%2===0?"even":"odd"}),s.append("text").text(function(t){var i=e.getTextFactor(t[0].worker);return t[0].worker.length>i?t[0].worker.substring(0,i)+"...":t[0].worker}).attr("dominant-baseline","central").attr("x",function(t,e){return 5}).attr("dy",function(t,e){return n/2}).attr("text-anchor","start")},t.prototype.getTextFactor=function(e){var i;return i=this.dimension().width()/this.textFactorBase,t.containsNonLatinCodepoints(e)&&(i/=2),i},t.prototype.clearNodes=function(){this.svgInstance.selectAll("g").remove()},t.prototype.setData=function(t){this.aData=t},t.containsNonLatinCodepoints=function(t){return/[^\u0000-\u00ff]/.test(t)},t.leftPadding=5,t}(),TimelineChart=function(){function t(t){if(this.chartModuleDom=null,this.chartSvg=null,this.rowHeight=21,this.chartRange=2400,this.chartStart=null,this.chartEnd=null,this.axisFormat="%H:%M",this.tooltipClass="tooltip",!t)throw new Error("Dimension is not set. ");this.aDimension=t;var e=new Date,i=e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate(),r=new Date(i+" 00:00:00"),n=new Date(i+" 23:59:59");this.setBusinessHours(r,n)}return t.prototype.dimension=function(){return this.aDimension},t.prototype.setRowHeight=function(t){this.rowHeight=t},t.prototype.height=function(){return Object.keys(this.aData).length*this.rowHeight},t.prototype.width=function(){return this.dimension().width()},t.prototype.setData=function(t){this.aData=t},t.prototype.setXAxisFormat=function(t){this.axisFormat=t},t.prototype.drawTimeline=function(e){e||(e=this.timelineSvg);var i=this.xScale=this.updateXAxis(),r=d3.svg.axis().scale(i).orient("top").ticks(d3.time.minutes,30).tickSize(6).tickFormat(d3.time.format(this.axisFormat));e.attr("width",this.chartRange).attr("class","changed").append("g").attr("class","axis").attr("transform","translate(0, "+(t.timelineHeight-1)+")").call(r)},t.prototype.drawGrid=function(t){t||(t=this.chartSvg);var e=48,i=d3.scale.linear().domain([0,this.chartRange]).range([0,this.chartRange]),r=d3.svg.axis().scale(i).orient("bottom").ticks(e).tickFormat("").tickSize(-this.chartRange,0);t.append("g").attr("class","grid").attr("transform","translate(0,"+this.chartRange+")").call(r)},t.prototype.init=function(e,i,r,n){this.gParent=i,this.moduleName=e,this.aData=r;var a=this.chartRange,s=this.aHeight=this.height(),o=this.gParent.append("div");o.attr("id",this.moduleName+"-chart").attr("class","chart-module"),o.attr("style","height: "+this.dimension().height()+"px; margin-left: "+(n+1)+"px;");var h=o.append("div");h.attr("class","chart-inner");var l=h.append("div");l.attr("class","chart-timeline").attr("style","height: "+t.timelineHeight+"px; ");var c=l.append("svg");c.attr("height",t.timelineHeight),this.timelineSvg=c;var p=h.append("div"),u=this.dimension().height()-t.timelineHeight;p.attr("class",t.scrollableTimelineClass),p.attr("style","height: "+u+"px");var d=p.append("svg");d.attr("width",a).attr("height",s),this.tooltip=p.append("div").attr("class",this.tooltipClass).style("opacity",0),this.tooltipInner=this.tooltip.append("foreignObject").append("div").attr("class","inner"),this.chartModuleDom=o,this.chartSvg=d},t.prototype.updateXAxis=function(){var t=this.chartStart.getTime(),e=this.chartEnd.getTime();return isNaN(t)||isNaN(e)||(this.chartRange=(e-t)/36e3,this.xScale=d3.time.scale().domain([t,e]).range([0,this.chartRange])),this.xScale},t.prototype.onMouseOver=function(t,e,i){},t.prototype.onMouseOut=function(t,e,i){},t.prototype.onClick=function(t,e,i){},t.prototype.titleOnHover=function(t,e){},t.prototype.determineOverlaps=function(t){var e={};t.filter(function(t){return t.type.markOverlap}).select("rect").attr("class",function(t,i){0===i&&(e[t.worker]=[]);for(var i in e[t.worker]){var r=e[t.worker][i],n=r.start,a=r.end;if(d3.max([n,t.starting_time])<d3.min([a,t.ending_time]))return t.type.overlapClass}return e[t.worker].push({start:t.starting_time,end:t.ending_time,marked:!1}),""})},t.prototype.drawBlocks=function(t){var e=this,i=this.rowHeight;t.append("rect").attr("fill",function(t){return t.type.backgroundColor}).attr("height",function(t){return t.type.height?+t.type.height:i}).attr("width",function(t){return e.xScale(new Date(t.ending_time))-e.xScale(new Date(t.starting_time))}).attr("stroke-width",function(t){return t.type.hasOwnProperty("strokeWidth")?t.type.strokeWidth:0}).attr("stroke",function(t){return t.type.hasOwnProperty("stroke")?t.type.stroke:0}).attr("rx",function(t){return t.type.hasOwnProperty("round")?t.type.round:0}).attr("style",function(t){var e="";return e+="stroke-opacity: "+t.type.opacity/2+";",e+="fill-opacity: "+t.type.opacity+";",t.type.hasLabel&&(e+="filter: url(#f1);"),e}).attr("y",function(t){return t.type.height<i?(i-t.type.height)/2:void 0})},t.appendDefinitions=function(t){var e=t.append("defs").append("filter").attr({x:0,y:0,width:"200%",height:"200%",id:"f1"});return e.append("feOffset").attr({result:"offOut","in":"SourceGraphic",dx:2,dy:7}),e.append("feGaussianBlur").attr({result:"blurOut","in":"matrixOut",stdDeviation:10}),e.append("feBlend").attr({"in":"SourceGraphic",in2:"blurOut",mode:"normal"}),e},t.prototype.drawLabels=function(t){var e=this.rowHeight;t.filter(function(t){return!(!t.type.hasOwnProperty("hasLabel")||t.type.hasLabel!==!0)}).append("text").text(this.labeling).attr("dx",function(t){return t.type.hasOwnProperty("round")?t.type.round+3:3}).attr("dy",function(){return e/2}).attr("style",function(t){return"fill: "+t.type.foregroundColor+"; font-size: "+(t.type.hasOwnProperty("fontSize")?t.type.fontSize:12)+"px"}).attr("dominant-baseline","central")},t.prototype.draw=function(){var e=this;this.drawTimeline(),this.chartSvg.attr("width",this.chartRange),this.chartSvg.attr("height",this.height()),this.drawGrid();var i=this,r=this.chartSvg.append("g").attr("transform","translate(0, 0)").attr("class","node-chart"),n=r.selectAll("g").data(d3.values(this.aData)),a=this.rowHeight;t.appendDefinitions(r);var s=n.enter().append("g").attr("class","chart-row").attr("transform",function(t,e){return"translate(0, "+a*e+")"}).attr("data-y",function(t,e){return a*e}),o=s.selectAll("g").data(function(t,e){return t}).enter().append("g").attr("transform",function(t){return"translate("+e.xScale(t.starting_time)+", 0)"}).attr("class","block").attr("id",function(t,e){var i=+d3.select(this.parentNode).attr("data-y");return t.type.id+"-"+i+"-"+e}).attr("data-x",function(t){return e.xScale(t.starting_time)}).on("mouseover",function(t,e){i.onMouseOver(this,t,e)}).on("mouseout",function(t,e){i.onMouseOut(this,t,e)}).on("click",function(t,e){i.onClick(this,t,e)});this.drawBlocks(o),this.determineOverlaps(o);var h=o.filter(function(t){return!(!t.type.hasOwnProperty("hasLabel")||t.type.hasLabel!==!0)}).append("svg:title");this.titleOnHover(h,this),this.drawLabels(o)},t.prototype.clearAll=function(){this.chartSvg.selectAll("*").remove()},t.prototype.clearNodes=function(){this.chartSvg.selectAll(".node-chart").remove()},t.prototype.clearTimeline=function(){this.timelineSvg.selectAll("g").remove()},t.prototype.clearGrid=function(){this.chartSvg.selectAll("g.grid").remove()},t.prototype.labeling=function(t,e){return t.place},t.prototype.setBusinessHours=function(t,e){this.chartStart=t,this.chartEnd=e,this.updateXAxis()},t.prototype.setDate=function(t){var e="00:00:00",i="23:59:59";this.setBusinessHours(new Date(t+" "+e),new Date(t+" "+i))},t.prototype.getChartSVGHeight=function(){var t=+$("#"+this.moduleName).height(),e=+this.chartSvg.attr("height");return e>t?t:e},t.prototype.showTooltip=function(e){var i=this;return this.tooltip.transition().duration(300).attr("style",function(){var r=d3.select(e).select(function(){return this.parentNode}).node(),n=i.getChartSVGHeight(),a=+d3.select(r).attr("data-y"),s=a-$("."+t.scrollableTimelineClass,"#"+i.moduleName).scrollTop()>n/2,o=i.tooltip.node().getBoundingClientRect(),h=i.rowHeight/2,l=+d3.select(e).select("rect").attr("height")/2,c=s?h-l-o.height:h+l;return"opacity: 1; left: "+d3.select(e).attr("data-x")+"px; top: "+(+d3.select(r).attr("data-y")+c)+"px"}),this.tooltipInner},t.prototype.hideTooltip=function(){return this.tooltip.attr("style",function(){return"opacity: 0;"}),this.tooltipInner},t.scrollableTimelineClass="timeline-scrollable",t.timelineHeight=21,t}(),TimelineScheduler=function(){function t(e,i,r,n,a){if(!(e&&i&&n&&a))throw new Error("Unable to initialize class. ");this.targetName=e,this.targetStem=t.getStem(e),this.chart=n,this.grouping=a,this.aDimension=i;var s=this.aTargetInner=this.initGParent(e);this.initData(r,s)}return t.getStem=function(t){return t.replace("#","").replace(".","")},t.prototype.dimension=function(){return this.aDimension},t.prototype.target=function(){return this.aTarget},t.processData=function(t,e,i){void 0===i&&(i="asc");var r,n,a=_.groupBy(t,e);for(var s in a)n=a[s],r=_.sortBy(n,function(t){return"asc"===i?t.type.zIndex:-t.type.zIndex}),a[s]=r;return a},t.prototype.initGParent=function(e){this.aTarget=d3.select(e),this.aTarget.attr("class",t.scheduleModuleClass).attr("style","width: "+this.dimension().width()+(+this.dimension().width()>=0?"px":"")+"; height: "+this.dimension().height()+(+this.dimension().height()>=0?"px":"")+";");var i=this.aTarget.append("div");return i.attr("class",t.scheduleInnerClass),i},t.prototype.initData=function(e,i){this.aData=e,i||(i=this.aTargetInner),this.grouping.init(this.targetStem,i,this.aData),this.chart.init(this.targetStem,i,this.aData,this.grouping.dimension().width()),$("."+TimelineChart.scrollableTimelineClass,this.targetName).on("scroll",function(){$("."+t.listModuleClass,this.targetName).scrollTop($(this).scrollTop()),$("."+t.chartTimelineClass,this.targetName).scrollLeft($(this).scrollLeft())})},t.prototype.setData=function(t){this.chart.setData(t),this.grouping.setData(t)},t.prototype.clear=function(){this.chart.clearNodes(),this.chart.clearTimeline(),this.chart.clearGrid(),this.grouping.clearNodes()},t.prototype.render=function(){this.grouping.drawData(),this.chart.draw()},t.prototype.reRender=function(){this.clear(),this.render()},t.prototype.softRender=function(){},t.scheduleModuleClass="scheduler-module",t.scheduleInnerClass="scheduler-inner",t.listModuleClass="list-module",t.chartTimelineClass="chart-timeline",t}();