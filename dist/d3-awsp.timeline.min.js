var TwoDimensionalShape=function(){function t(t,e){this.aHeight=e,this.aWidth=t}return t.prototype.width=function(t){if(t)if(+t>0)this.aWidth=t;else if(!(t.toString().match(/\%/).length>=0))throw new Error("Width must be a number and greater than 0. ");return this.aWidth},t.prototype.height=function(t){if(t){if(!(+t>0))throw new Error("Height must be a number and greater than 0. ");this.aHeight=t}return this.aHeight},t}(),TimelineGroup=function(){function t(t){if(this.domInstance=null,this.svgInstance=null,this.rowHeight=21,this.aHeight=0,!t)throw new Error("Dimension is not set. ");this.aDimension=t}return t.prototype.dimension=function(){return this.aDimension},t.prototype.height=function(){var t=+this.dimension().height();return this.aHeight>t?this.aHeight:t},t.prototype.setRowHeight=function(t){this.rowHeight=t},t.prototype.getRowHeight=function(){return this.rowHeight},t.prototype.init=function(t,e,i){this.gParent=e,this.moduleName=t,this.aData=i;var n=this.aHeight=Object.keys(i).length*this.rowHeight,r=this.gParent.append("div");r.attr("id",this.moduleName+"-grouping").attr("class","list-module"),r.attr("style","width: "+this.dimension().width()+(+this.dimension().width()>=0?"px":"")+"; height: "+(this.dimension().height()-TimelineChart.timelineHeight)+"px; margin-top: "+TimelineChart.timelineHeight+"px;");var a=r.append("svg");a.attr("width",this.dimension().width()).attr("height",n),this.domInstance=r,this.svgInstance=a},t.prototype.drawData=function(t){t||(t=this.aData);var e=this.svgInstance,i=e.append("g").attr("transform","translate(0, 0)"),n=this.rowHeight,r=i.selectAll("g").data(d3.values(t)),a=r.enter().append("g").attr("transform",function(t,e){return"translate(0, "+n*e+")"});a.append("rect").attr("height",n).attr("width",this.dimension().width()).attr("class",function(t,e){return e%2===0?"even":"odd"}),a.append("text").text(function(t){return t[0].worker}).attr("dominant-baseline","central").attr("x",function(t,e){return 5}).attr("dy",function(t,e){return n/2}).attr("text-anchor","start")},t.prototype.clearNodes=function(){this.svgInstance.selectAll("g").remove()},t.prototype.setData=function(t){this.aData=t},t.leftPadding=5,t}(),TimelineChart=function(){function t(t){if(this.chartModuleDom=null,this.chartSvg=null,this.rowHeight=21,this.chartRange=2400,this.chartStart=null,this.chartEnd=null,this.axisFormat="%I:%M",!t)throw new Error("Dimension is not set. ");this.aDimension=t;var e=new Date,i=e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate(),n=new Date(i+" 00:00:00"),r=new Date(i+" 23:59:59");this.setBusinessHours(n,r)}return t.prototype.dimension=function(){return this.aDimension},t.prototype.setRowHeight=function(t){this.rowHeight=t},t.prototype.height=function(){var t=+this.dimension().height();return this.aHeight>t?this.aHeight:t},t.prototype.width=function(){return this.dimension().width()},t.prototype.setData=function(t){this.aData=t},t.prototype.drawTimeline=function(){var e=this.xScale=this.updateXAxis(),i=d3.svg.axis().scale(e).orient("top").ticks(d3.time.minutes,30).tickSize(6).tickFormat(d3.time.format(this.axisFormat));this.timelineSvg.attr("width",this.chartRange).attr("class","changed").append("g").attr("class","axis").attr("transform","translate(0, "+(t.timelineHeight-1)+")").call(i)},t.prototype.init=function(e,i,n,r){this.gParent=i,this.moduleName=e,this.aData=n;var a=this.chartRange,s=this.aHeight=Object.keys(n).length*this.rowHeight,o=this.gParent.append("div");o.attr("id",this.moduleName+"-chart").attr("class","chart-module"),o.attr("style","height: "+this.dimension().height()+"px; margin-left: "+(r+1)+"px;");var h=o.append("div");h.attr("class","chart-inner");var l=h.append("div");l.attr("class","chart-timeline").attr("style","height: "+t.timelineHeight+"px; ");var c=l.append("svg");c.attr("height",t.timelineHeight),this.timelineSvg=c;var u=h.append("div"),p=this.dimension().height()-t.timelineHeight;u.attr("class",t.scrollableTimelineClass),u.attr("style","height: "+p+"px");var d=u.append("svg");d.attr("width",a).attr("height",s);var g=48,m=d3.scale.linear().domain([0,a]).range([0,a]),f=d3.svg.axis().scale(m).orient("bottom").ticks(g).tickFormat("").tickSize(-a,0);d.append("g").attr("class","grid").attr("transform","translate(0,"+a+")").call(f),this.chartModuleDom=o,this.chartSvg=d},t.prototype.updateXAxis=function(){var t=this.chartStart.getTime(),e=this.chartEnd.getTime();return this.chartRange=(e-t)/36e3,this.xScale=d3.time.scale().domain([t,e]).range([0,this.chartRange]),this.xScale},t.prototype.onMouseOver=function(t,e,i){},t.prototype.onMouseOut=function(t,e,i){},t.prototype.titleOnHover=function(t){},t.prototype.drawData=function(){var t=this;this.drawTimeline(),this.chartSvg.attr("width",this.chartRange);var e=this,i=this.chartSvg.append("g").attr("transform","translate(0, 0)").attr("class","node-chart"),n=i.selectAll("g").data(d3.values(this.aData)),r=this.rowHeight,a=i.append("defs").append("filter").attr({x:0,y:0,width:"200%",height:"200%",id:"f1"});a.append("feOffset").attr({result:"offOut","in":"SourceGraphic",dx:2,dy:7}),a.append("feGaussianBlur").attr({result:"blurOut","in":"matrixOut",stdDeviation:10}),a.append("feBlend").attr({"in":"SourceGraphic",in2:"blurOut",mode:"normal"});var s=n.enter().append("g").attr("class","chart-row").attr("transform",function(t,e){return"translate(0, "+r*e+")"}),o=s.selectAll("g").data(function(t,e){return t}).enter().append("g").attr("transform",function(e){return"translate("+t.xScale(e.starting_time)+", 0)"}).attr("class","block").on("mouseover",function(t,i){e.onMouseOver(this,t,i)}).on("mouseout",function(t,i){e.onMouseOut(this,t,i)});o.append("rect").attr("fill",function(t){return t.type.backgroundColor}).attr("height",function(t){return t.type.height}).attr("width",function(e){return t.xScale(new Date(e.ending_time))-t.xScale(new Date(e.starting_time))}).attr("stroke-width",function(t){return t.type.hasOwnProperty("strokeWidth")?t.type.strokeWidth:0}).attr("stroke",function(t){return t.type.hasOwnProperty("stroke")?t.type.stroke:0}).attr("rx",function(t){return t.type.hasOwnProperty("round")?t.type.round:0}).attr("style",function(t){var e="";return e+="stroke-opacity: "+t.type.opacity/2+";",e+="fill-opacity: "+t.type.opacity+";",t.type.hasLabel&&(e+="filter: url(#f1);"),e}).attr("y",function(t){return t.type.height<r?(r-t.type.height)/2:void 0});var h=o.filter(function(t){return!(!t.type.hasOwnProperty("hasLabel")||t.type.hasLabel!==!0)}).append("svg:title");this.titleOnHover(h),o.filter(function(t){return!(!t.type.hasOwnProperty("hasLabel")||t.type.hasLabel!==!0)}).append("text").text(e.labeling).attr("dx",function(t){return t.type.hasOwnProperty("round")?t.type.round+3:3}).attr("dy",function(){return r/2}).attr("style",function(t){return"fill: "+t.type.foregroundColor+"; font-size: "+(t.type.hasOwnProperty("fontSize")?t.type.fontSize:12)+"px"}).attr("dominant-baseline","central")},t.prototype.clearAll=function(){this.chartSvg.selectAll("*").remove()},t.prototype.clearNodes=function(){this.chartSvg.selectAll(".node-chart").remove()},t.prototype.clearTimeline=function(){this.timelineSvg.selectAll("g").remove()},t.prototype.labeling=function(t,e){return t.place},t.prototype.setBusinessHours=function(t,e){this.chartStart=t,this.chartEnd=e,this.updateXAxis()},t.prototype.setDate=function(t){var e="00:00:00",i="23:59:59";this.setBusinessHours(new Date(t+" "+e),new Date(t+" "+i))},t.scrollableTimelineClass="timeline-scrollable",t.timelineHeight=21,t}(),TimelineScheduler=function(){function t(e,i,n,r,a){if(!(e&&i&&r&&a))throw new Error("Unable to initialize class. ");this.targetName=e,this.targetStem=t.getStem(e),this.chart=r,this.grouping=a,this.aDimension=i;var s=this.aTargetInner=this.initGParent(e);this.initData(n,s)}return t.getStem=function(t){return t.replace("#","").replace(".","")},t.prototype.dimension=function(){return this.aDimension},t.prototype.target=function(){return this.aTarget},t.processData=function(t,e,i){void 0===i&&(i="asc");var n,r,a=_.groupBy(t,e);for(var s in a)r=a[s],n=_.sortBy(r,function(t){return"asc"===i?t.type.zIndex:-t.type.zIndex}),a[s]=n;return a},t.prototype.initGParent=function(e){this.aTarget=d3.select(e),this.aTarget.attr("class",t.scheduleModuleClass).attr("style","width: "+this.dimension().width()+(+this.dimension().width()>=0?"px":"")+"; height: "+this.dimension().height()+(+this.dimension().height()>=0?"px":"")+";");var i=this.aTarget.append("div");return i.attr("class",t.scheduleInnerClass),i},t.prototype.initData=function(e,i){this.aData=e,i||(i=this.aTargetInner),this.grouping.init(this.targetStem,i,this.aData),this.chart.init(this.targetStem,i,this.aData,this.grouping.dimension().width()),$("."+TimelineChart.scrollableTimelineClass,this.targetName).on("scroll",function(){$("."+t.listModuleClass,this.targetName).scrollTop($(this).scrollTop()),$("."+t.chartTimelineClass,this.targetName).scrollLeft($(this).scrollLeft())})},t.prototype.setData=function(t){this.chart.setData(t),this.grouping.setData(t)},t.prototype.clear=function(){this.chart.clearNodes(),this.chart.clearTimeline(),this.grouping.clearNodes()},t.prototype.render=function(){this.grouping.drawData(),this.chart.drawData()},t.scheduleModuleClass="scheduler-module",t.scheduleInnerClass="scheduler-inner",t.listModuleClass="list-module",t.chartTimelineClass="chart-timeline",t}();